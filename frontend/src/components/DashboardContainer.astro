---
import RealtimeAnalysis from './RealtimeAnalysis.astro';
import ThreatDetections from './ThreatDetections.astro';
import DetectionRules from './DetectionRules.astro';
import AITextToRule from './AITextToRule.astro';
---
---

<link rel="stylesheet" href="/src/components/DashboardContainer.css">

<main class="dashboard-container">



  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-section">
      <div class="logo-icon">LS</div>
      <div class="logo-text">LOGSENTINEL</div>
    </div>

    <div class="nav-section">
      <h3>Navigation</h3>
      <ul class="nav-list">
        <li class="nav-item">
          <a href="#" class="nav-link active" id="dashboard-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="threat-detections-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Generated Alerts
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="ai-text-to-rule-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
              <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            AI Text to Rule
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="detection-rules-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Detection Rules
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <header class="header">
      <div class="header-title">
        <h1>Command Center</h1>
        <div class="header-subtitle">Real-time log analysis and threat detection</div>
    </div>
    <div class="header-right-content">
      <p>System Status: <span style="color: #4CAF50;">Operational</span></p>
      <p class="clickable" id="header-alerts-trigger">Active Alerts: <span id="active-alerts-count" style="color: #FFC107; font-weight: bold;">0</span></p>
    </div>
    </header>



    <div id="dashboard-content">
      <RealtimeAnalysis />
    </div>

    <div id="threat-detections-content" style="display:none;">
      <ThreatDetections />
    </div>

    <div id="detection-rules-content" style="display:none;">
      <DetectionRules />
    </div>

    <div id="ai-text-to-rule-content" style="display:none;">
      <AITextToRule />
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dashboardLink = document.getElementById('dashboard-link');
    const threatDetectionsLink = document.getElementById('threat-detections-link');
    const detectionRulesLink = document.getElementById('detection-rules-link');
    const aiTextToRuleLink = document.getElementById('ai-text-to-rule-link');

    const dashboardContent = document.getElementById('dashboard-content');
    const threatDetectionsContent = document.getElementById('threat-detections-content');
    const detectionRulesContent = document.getElementById('detection-rules-content');
    const aiTextToRuleContent = document.getElementById('ai-text-to-rule-content');
    const activeAlertsSpan = document.getElementById('active-alerts-count');
    const headerAlertsTrigger = document.getElementById('header-alerts-trigger');

    const allContentSections = [dashboardContent, threatDetectionsContent, aiTextToRuleContent, detectionRulesContent];
    const allNavLinks = [dashboardLink, threatDetectionsLink, aiTextToRuleLink, detectionRulesLink];

    function showContent(contentToShow, activeLink) {
      allContentSections.forEach(section => {
        if (section) {
          section.style.display = 'none';
        }
      });
      allNavLinks.forEach(link => link.classList.remove('active'));

      if (contentToShow) {
        contentToShow.style.display = 'block';
      }
      if (activeLink) {
        activeLink.classList.add('active');
      }
    }

    // Initial load: show Dashboard content
    showContent(dashboardContent, dashboardLink);

    dashboardLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(dashboardContent, dashboardLink);
    });

    threatDetectionsLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(threatDetectionsContent, threatDetectionsLink);
    });

    detectionRulesLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(detectionRulesContent, detectionRulesLink);
    });

    aiTextToRuleLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(aiTextToRuleContent, aiTextToRuleLink);
    });

    // Make header alerts clickable
    if (headerAlertsTrigger) {
      headerAlertsTrigger.addEventListener('click', () => {
        showContent(threatDetectionsContent, threatDetectionsLink);
      });
    }

    // Global navigation listener for other components
    document.addEventListener('navigateToAlerts', () => {
      showContent(threatDetectionsContent, threatDetectionsLink);
    });

    // Listen for custom event to update active alerts
    document.addEventListener('totalAlertsUpdated', (event) => {
      if (activeAlertsSpan) {
        activeAlertsSpan.textContent = event.detail.totalAlerts;
      }
    });
  });
</script>