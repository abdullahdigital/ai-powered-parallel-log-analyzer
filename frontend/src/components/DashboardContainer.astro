---
import RealtimeAnalysis from './RealtimeAnalysis.astro';
import ThreatDetections from './ThreatDetections.astro';
import DetectionRules from './DetectionRules.astro';
import AITextToRule from './AITextToRule.astro';
---
---

<link rel="stylesheet" href="/src/components/DashboardContainer.css">

<main class="dashboard-container">



  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo-section">
      <div class="logo-icon">LS</div>
      <div class="logo-text">LOGSENTINEL</div>
    </div>

    <div class="nav-section">
      <h3>Navigation</h3>
      <ul class="nav-list">
        <li class="nav-item">
          <a href="#" class="nav-link active" id="dashboard-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="detection-rules-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Detection Rules
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="ai-text-to-rule-link">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5a3 3 0 1 0-3 3"></path>
              <path d="M12 5a3 3 0 1 1 3 3"></path>
              <path d="M12 7a6 6 0 0 1 6 6v3a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2 1 1 0 0 1-1-1V7a3 3 0 0 0-3-3H8a3 3 0 0 0-3 3v1a1 1 0 0 1-1 1 2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2v-3a6 6 0 0 1 6-6z"></path>
            </svg>
            AI Text to Rule
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <header class="header">
      <div class="header-title">
        <h1>Command Center</h1>
        <div class="header-subtitle">Real-time log analysis and threat detection</div>
    </div>
    <div class="header-right-content">
      <!-- Placeholder for interesting content -->
      <p>System Status: <span style="color: #4CAF50;">Operational</span></p>
      <p>Active Alerts: <span id="active-alerts-count" style="color: #FFC107;">0</span></p>
    </div>
    </header>



    <div id="dashboard-content">
      <RealtimeAnalysis />
    </div>

    <div id="threat-detections-content" style="display:none;">
      <ThreatDetections />
    </div>

    <div id="detection-rules-content" style="display:none;">
      <DetectionRules />
    </div>

    <div id="ai-text-to-rule-content" style="display:none;">
      <AITextToRule />
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dashboardLink = document.getElementById('dashboard-link');
    const detectionRulesLink = document.getElementById('detection-rules-link');
    const aiTextToRuleLink = document.getElementById('ai-text-to-rule-link');

    const dashboardContent = document.getElementById('dashboard-content');
    const threatDetectionsContent = document.getElementById('threat-detections-content');
    const detectionRulesContent = document.getElementById('detection-rules-content');
    const aiTextToRuleContent = document.getElementById('ai-text-to-rule-content');
    const activeAlertsSpan = document.getElementById('active-alerts-count');

    const allContentSections = [dashboardContent, threatDetectionsContent, detectionRulesContent, aiTextToRuleContent];
    const allNavLinks = [dashboardLink, detectionRulesLink, aiTextToRuleLink];

    function showContent(contentToShow, activeLink) {
      allContentSections.forEach(section => {
        if (section) {
          section.style.display = 'none';
        }
      });
      allNavLinks.forEach(link => link.classList.remove('active'));

      if (contentToShow) {
        contentToShow.style.display = 'block';
      }
      if (activeLink) {
        activeLink.classList.add('active');
      }
    }

    // Initial load: show Dashboard content
    showContent(dashboardContent, dashboardLink);

    dashboardLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(dashboardContent, dashboardLink);
    });

    detectionRulesLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(detectionRulesContent, detectionRulesLink);
    });

    aiTextToRuleLink.addEventListener('click', (e) => {
      e.preventDefault();
      showContent(aiTextToRuleContent, aiTextToRuleLink);
    });

    // Listen for custom event to update active alerts
    document.addEventListener('totalAlertsUpdated', (event) => {
      if (activeAlertsSpan) {
        activeAlertsSpan.textContent = event.detail.totalAlerts;
      }
    });
  });
</script>